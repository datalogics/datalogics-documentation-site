[build]
  command = "bun run build:prod"
  publish = "dist"

[build.environment]
  NODE_OPTIONS = "--max-old-space-size=8192"
  NODE_VERSION = "22"

# IMPORTANT: Order matters - most specific routes first
# Studio routes and API routes need SSR (everything else is pre-rendered static)

# API routes - must come before catch-all
[[redirects]]
  from = "/api/*"
  to = "/.netlify/functions/server"
  status = 200
  force = true

# Studio internal routes
[[redirects]]
  from = "/__nuxt_studio/*"
  to = "/.netlify/functions/server"
  status = 200
  force = true

# Studio UI routes
[[redirects]]
  from = "/_studio/*"
  to = "/.netlify/functions/server"
  status = 200
  force = true

# Catch-all: serve static files first, then fall back to SSR for dynamic routes
# Netlify serves prerendered files from dist/ automatically
# This only applies if no static file exists
[[redirects]]
  from = "/*"
  to = "/.netlify/functions/server"
  status = 200